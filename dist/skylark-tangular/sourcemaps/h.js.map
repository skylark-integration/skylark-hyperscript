{"version":3,"sources":["h.js"],"names":["define","types","arrays","hoster","hyperscript","isArray","isNode","isHtmlNode","forEach","document","Text","w","split","s","arg","addClass","el","cls","classList","add","context","cleanupFuncs","h","args","slice","call","arguments","e","item","l","r","m","appendChild","createTextNode","test","createElement","v","substring","length","setAttribute","Date","RegExp","toString","k","addEventListener","push","removeEventListener","attachEvent","detachEvent","style","cssText","setProperty","val","match","substr","parentElement","replaceChild","textContent","shift","cleanup","i"],"mappings":"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","file":"../h.js","sourcesContent":["define([\r\n\t\"skylark-langx/types\",\r\n\t\"skylark-langx/arrays\",\r\n\t\"skylark-langx/hoster\",\r\n\t\"./hyperscript\"\r\n],function(types, arrays,hoster, hyperscript){\r\n\tvar isArray = types.isArray,\r\n\t\tisNode = types.isHtmlNode,\r\n\t\tforEach = arrays.forEach,\t\r\n\t\tdocument = hoster.document,\r\n\t\tText = w.Text,\r\n\t\tsplit = function(s,arg) {\r\n\t\t\treturn s.split(arg);\r\n\t\t},\r\n\t\taddClass = function(el,cls) {\r\n\t\t\tel.classList.add(cls);\r\n\t\t};\r\n\r\n\tfunction context () {\r\n\r\n\t  var cleanupFuncs = []\r\n\r\n\t  function h() {\r\n\t    var args = [].slice.call(arguments), e = null\r\n\t    function item (l) {\r\n\t      var r\r\n\t      function parseClass (string) {\r\n\r\n\t        var m = split(string, /([\\.#]?[^\\s#.]+)/)\r\n\t        if(/^\\.|#/.test(m[1])) {\r\n\t          e = document.createElement('div');\r\n\t        }\r\n\t        forEach(m, function (v) {\r\n\t          var s = v.substring(1,v.length);\r\n\t          if(!v) {\r\n\t          \treturn ;\r\n\t          }\r\n\t          if(!e) {\r\n\t            e = document.createElement(v);\r\n\t          } else if (v[0] === '.') {\r\n\t            addClass(e,s);\r\n\t          } else if (v[0] === '#') {\r\n\t            e.setAttribute('id', s);\r\n\t          }\r\n\t        })\r\n\t      }\r\n\r\n\t      if(l == null) {\r\n\t        ;\r\n\t      } else if('string' === typeof l) {\r\n\t        if(!e) {\r\n\t          parseClass(l)\r\n\t        } else {\r\n\t          e.appendChild(r = document.createTextNode(l))\r\n\t        }\r\n\t      } else if('number' === typeof l\r\n\t        || 'boolean' === typeof l\r\n\t        || l instanceof Date\r\n\t        || l instanceof RegExp ) {\r\n\t          e.appendChild(r = document.createTextNode(l.toString()))\r\n\t      } else if (isArray(l)) {\r\n\t        forEach(l, item) ;\r\n\t      } else if(isNode(l)) {\r\n\t        e.appendChild(r = l)\r\n\t      } else if(l instanceof Text) {\r\n\t        e.appendChild(r = l)\r\n\t      } else if ('object' === typeof l) {\r\n\t        for (var k in l) {\r\n\t          if('function' === typeof l[k]) {\r\n\t            if(/^on\\w+/.test(k)) {\r\n\t              (function (k, l) { // capture k, l in the closure\r\n\t                if (e.addEventListener){\r\n\t                  e.addEventListener(k.substring(2), l[k], false)\r\n\t                  cleanupFuncs.push(function(){\r\n\t                    e.removeEventListener(k.substring(2), l[k], false)\r\n\t                  })\r\n\t                }else{\r\n\t                  e.attachEvent(k, l[k])\r\n\t                  cleanupFuncs.push(function(){\r\n\t                    e.detachEvent(k, l[k])\r\n\t                  })\r\n\t                }\r\n\t              })(k, l)\r\n\t            } else {\r\n\t              // observable\r\n\t              e[k] = l[k]()\r\n\t              cleanupFuncs.push(l[k](function (v) {\r\n\t                e[k] = v\r\n\t              }))\r\n\t            }\r\n\t          }\r\n\t          else if(k === 'style') {\r\n\t            if('string' === typeof l[k]) {\r\n\t              e.style.cssText = l[k]\r\n\t            }else{\r\n\t              for (var s in l[k]) (function(s, v) {\r\n\t                if('function' === typeof v) {\r\n\t                  // observable\r\n\t                  e.style.setProperty(s, v())\r\n\t                  cleanupFuncs.push(v(function (val) {\r\n\t                    e.style.setProperty(s, val)\r\n\t                  }))\r\n\t                } else\r\n\t                  var match = l[k][s].match(/(.*)\\W+!important\\W*$/);\r\n\t                  if (match) {\r\n\t                    e.style.setProperty(s, match[1], 'important')\r\n\t                  } else {\r\n\t                    e.style.setProperty(s, l[k][s])\r\n\t                  }\r\n\t              })(s, l[k][s])\r\n\t            }\r\n\t          } else if(k === 'attrs') {\r\n\t            for (var v in l[k]) {\r\n\t              e.setAttribute(v, l[k][v])\r\n\t            }\r\n\t          } else if (k.substr(0, 5) === \"data-\") {\r\n\t            e.setAttribute(k, l[k])\r\n\t          } else {\r\n\t            e[k] = l[k]\r\n\t          }\r\n\t        }\r\n\t      } else if ('function' === typeof l) {\r\n\t        //assume it's an observable!\r\n\t        var v = l()\r\n\t        e.appendChild(r = isNode(v) ? v : document.createTextNode(v))\r\n\r\n\t        cleanupFuncs.push(l(function (v) {\r\n\t          if(isNode(v) && r.parentElement) {\r\n\t            r.parentElement.replaceChild(v, r), r = v\r\n\t          } else {\r\n\t            r.textContent = v ;\r\n\t          }\r\n\t        }))\r\n\t      }\r\n\r\n\t      return r\r\n\t    }\r\n\t    while(args.length) {\r\n\t      item(args.shift())\r\n\t    }\r\n\r\n\t    return e\r\n\t  }\r\n\r\n\t  h.cleanup = function () {\r\n\t    for (var i = 0; i < cleanupFuncs.length; i++){\r\n\t      cleanupFuncs[i]()\r\n\t    }\r\n\t    cleanupFuncs.length = 0\r\n\t  }\r\n\r\n\t  return h\r\n\t}\r\n\r\n\tvar h =  context() ;\r\n\th.context = context ;\r\n\r\n\treturn hyperscript.h = h;\r\n\r\n});"]}